<h1>ğŸ—ºï¸ åœ°å›³è¡¨ç¤ºã‚¢ãƒ—ãƒª</h1>

<%= form_with url: maps_path, method: :get, local: true do |f| %>
  <%= f.label :city, "éƒ½å¸‚åã‚’å…¥åŠ›ï¼š" %>
  <%= f.text_field :city, value: params[:city] %>
  <%= f.submit "åœ°å›³è¡¨ç¤º" %>
<% end %>

<div id="map" style="height: 500px; width: 100%; margin-top: 20px;"></div>

<% if params[:city].present? %>
  <script>
    async function initMap() {
      const city = "<%= j params[:city] %>";

      // Googleã®ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°APIã‚’ä½¿ã£ã¦éƒ½å¸‚ã®åº§æ¨™ã‚’å–å¾—
      const res = await fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(city)}&key=AIzaSyApFOiMh8pH_dY9Zs8P9Tieslwbu7Ni4-Y`);
      const data = await res.json();

      if (data.status === "OK") {
        const location = data.results[0].geometry.location;
        const map = new google.maps.Map(document.getElementById("map"), {
          center: location,
          zoom: 10,
        });

        new google.maps.Marker({
          position: location,
          map: map,
          title: city,
        });
      } else {
        alert("éƒ½å¸‚ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼");
      }
    }
    window.initMap = initMap;
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApFOiMh8pH_dY9Zs8P9Tieslwbu7Ni4-Y&callback=initMap">
  </script>
<% end %>

